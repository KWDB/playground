# KWDB Playground æ¶æ„é—®é¢˜æ±‡æ€»

> æœ¬æ–‡æ¡£è®°å½•ä»£ç åº“ä¸­å‘ç°çš„æ¶æ„å’Œä»£ç è´¨é‡é—®é¢˜ï¼ŒæŒ‰ä¸¥é‡ç¨‹åº¦åˆ†ç±»ã€‚
> ç”Ÿæˆæ—¥æœŸ: 2026-02-10

---

## ğŸ”´ ä¸¥é‡é—®é¢˜ (Critical)

### 1. å®¹å™¨IDè§£æé€»è¾‘ç¼ºé™· âœ… å·²ä¿®å¤

**çŠ¶æ€**: **å·²ä¿®å¤** (2026-02-10)

**ä½ç½®**: `internal/docker/controller.go:189`

**é—®é¢˜æè¿°**:
å®¹å™¨åç§°æ ¼å¼ä¸º `kwdb-playground-{courseID}-{timestamp}`ï¼Œä½†è§£æé€»è¾‘ä½¿ç”¨ç®€å•çš„å­—ç¬¦ä¸²åˆ†å‰²ï¼š
```go
courseID := strings.Join(parts[2:len(parts)-1], "-")
```
å½“è¯¾ç¨‹IDæœ¬èº«åŒ…å«è¿å­—ç¬¦ï¼ˆå¦‚ `quick-start`ï¼‰æ—¶ï¼Œè§£æé€»è¾‘ä¼šé”™è¯¯åœ°å°†æ—¶é—´æˆ³çš„ä¸€éƒ¨åˆ†ä¹ŸåŒ…å«è¿›è¯¾ç¨‹IDã€‚

**æ½œåœ¨å½±å“**:
- å®¹å™¨çŠ¶æ€æŸ¥è¯¢é”™è¯¯
- è¯¾ç¨‹åˆ‡æ¢æ—¶æ— æ³•æ­£ç¡®åœæ­¢/å¯åŠ¨å®¹å™¨
- å¹¶å‘æ“ä½œå¯èƒ½è¯¯æ“ä½œå…¶ä»–è¯¾ç¨‹çš„å®¹å™¨

**ä¿®å¤æ–¹æ¡ˆ**:
1. **åˆ›å»ºå®¹å™¨æ—¶æ·»åŠ  Labels å­˜å‚¨å…ƒæ•°æ®** (`internal/docker/controller.go:913-919`):
```go
containerConfig := &container.Config{
    Labels: map[string]string{
        LabelAppName:   "kwdb-playground",
        LabelCourseID:  courseID,
        LabelVersion:   "1.0",
        LabelCreatedAt: time.Now().Format(time.RFC3339),
    },
}
```

2. **ä¼˜å…ˆä» Labels è¯»å–è¯¾ç¨‹ID** (`internal/docker/controller.go:195-221`):
   - é¦–å…ˆå°è¯•ä» Docker Labels è¯»å– `kwdb-playground.course-id`
   - å¦‚æœ Labels ä¸å­˜åœ¨ï¼Œå›é€€åˆ°åç§°è§£æï¼ˆå‘åå…¼å®¹æ—§å®¹å™¨ï¼‰
   - æ”¹è¿›äº†åç§°è§£æé€»è¾‘ï¼Œæ­£ç¡®è¯†åˆ«æ—¶é—´æˆ³åç¼€

3. **æ›´æ–°æ¸…ç†é€»è¾‘** (`CleanupCourseContainers` å’Œ `CleanupAllContainers`):
   - ä½¿ç”¨ Labels åŒ¹é…è¯¾ç¨‹å®¹å™¨
   - æ”¯æŒé€šè¿‡ Label `kwdb-playground.app` è¯†åˆ« Playground å®¹å™¨

**æµ‹è¯•è¦†ç›–**:
- æ·»åŠ äº†å•å…ƒæµ‹è¯• `TestParseCourseIDFromContainerName`
- æµ‹è¯•è¦†ç›–æ ‡å‡†è¯¾ç¨‹IDã€å«è¿å­—ç¬¦çš„è¯¾ç¨‹IDã€å¤šä¸ªè¿å­—ç¬¦çš„æƒ…å†µ
- éªŒè¯å‘åå…¼å®¹æ€§

**ç›¸å…³æ–‡ä»¶**:
- `internal/docker/types.go`: æ·»åŠ æ ‡ç­¾å¸¸é‡å®šä¹‰
- `internal/docker/controller.go`: ä¿®æ”¹å®¹å™¨åˆ›å»ºã€åŠ è½½ã€æ¸…ç†é€»è¾‘
- `internal/docker/controller_test.go`: æ·»åŠ å•å…ƒæµ‹è¯•

---

### 2. SQLé©±åŠ¨å•ä¾‹å¹¶å‘é—®é¢˜ âœ… å·²ä¿®å¤

**çŠ¶æ€**: **å·²ä¿®å¤** (2026-02-10)

**ä½ç½®**: `internal/api/routes.go:71`

**é—®é¢˜æè¿°**:
```go
sqlDriver: &sql.Driver{},
```
`sqlDriver` ä½œä¸ºå…¨å±€å•ä¾‹è¢«æ‰€æœ‰è¯¾ç¨‹å…±äº«ï¼Œä½†å†…éƒ¨ç»´æŠ¤å•ä¸€è¿æ¥æ± ã€‚å½“å¤šä¸ªè¯¾ç¨‹åŒæ—¶è¿è¡Œæ—¶ï¼ŒSQLæŸ¥è¯¢ä¼šç«äº‰åŒä¸€è¿æ¥æ± ï¼Œå¯èƒ½å¯¼è‡´ï¼š
- æŸ¥è¯¢ç»“æœè¢«é”™è¯¯åœ°è·¯ç”±åˆ°é”™è¯¯çš„æ•°æ®åº“
- è¿æ¥æ± è€—å°½å¯¼è‡´è¯·æ±‚å¤±è´¥
- äº‹åŠ¡éš”ç¦»æ€§é—®é¢˜

**æ½œåœ¨å½±å“**:
- æ•°æ®æ³„éœ²é£é™©ï¼ˆAè¯¾ç¨‹çš„æŸ¥è¯¢å¯èƒ½è¿”å›Bè¯¾ç¨‹çš„æ•°æ®ï¼‰
- å¹¶å‘æ€§èƒ½ç“¶é¢ˆ
- æ•°æ®åº“è¿æ¥é”™è¯¯

**ä¿®å¤æ–¹æ¡ˆ**:
1. **åˆ›å»º DriverManager ç®¡ç†å™¨** (`internal/sql/manager.go`):
```go
type DriverManager struct {
    drivers map[string]*Driver // key: courseID
    mu      sync.RWMutex
}

func (m *DriverManager) GetDriver(courseID string) *Driver {
    // æŒ‰éœ€åˆ›å»ºå’Œç®¡ç†ç‹¬ç«‹é©±åŠ¨å®ä¾‹
    // ä½¿ç”¨è¯»å†™é”ä¿è¯å¹¶å‘å®‰å…¨
}
```

2. **æŒ‰è¯¾ç¨‹éš”ç¦»è¿æ¥æ± **:
   - æ¯ä¸ªè¯¾ç¨‹æ‹¥æœ‰ç‹¬ç«‹çš„ `*sql.Driver` å®ä¾‹
   - æ¯ä¸ªé©±åŠ¨ç»´æŠ¤è‡ªå·±çš„ `*pgxpool.Pool` è¿æ¥æ± 
   - ä½¿ç”¨è¯¾ç¨‹IDä½œä¸ºé”®ç®¡ç†å¤šä¸ªé©±åŠ¨å®ä¾‹

3. **æ›´æ–° Handler ä½¿ç”¨ç®¡ç†å™¨** (`internal/api/routes.go`):
   - å°† `sqlDriver *sql.Driver` æ›¿æ¢ä¸º `sqlDriverManager *sql.DriverManager`
   - æ‰€æœ‰ SQL æ“ä½œé€šè¿‡ `sqlDriverManager.Pool(courseID)` è·å–å¯¹åº”è¯¾ç¨‹çš„è¿æ¥æ± 
   - WebSocket SQL ç»ˆç«¯æ ¹æ®å½“å‰è¯¾ç¨‹è·å–æ­£ç¡®çš„è¿æ¥

4. **å¹¶å‘å®‰å…¨ä¿éšœ**:
   - ä½¿ç”¨ `sync.RWMutex` ä¿æŠ¤é©±åŠ¨æ˜ å°„è¡¨
   - åŒé‡æ£€æŸ¥é”å®šæ¨¡å¼é˜²æ­¢é‡å¤åˆ›å»º
   - æä¾› `RemoveDriver` æ–¹æ³•åœ¨è¯¾ç¨‹åœæ­¢æ—¶æ¸…ç†èµ„æº

**æµ‹è¯•è¦†ç›–**:
- `TestDriverManagerConcurrentAccess`: éªŒè¯å¹¶å‘è®¿é—®å®‰å…¨æ€§
- `TestDriverManagerRemoveDriver`: éªŒè¯é©±åŠ¨ç§»é™¤åŠŸèƒ½
- `TestDriverManagerClose`: éªŒè¯èµ„æºæ¸…ç†
- `BenchmarkDriverManagerGetDriver`: æ€§èƒ½åŸºå‡†æµ‹è¯•

**ç›¸å…³æ–‡ä»¶**:
- `internal/sql/manager.go`: æ–°å¢é©±åŠ¨ç®¡ç†å™¨å®ç°
- `internal/sql/manager_test.go`: æ–°å¢å•å…ƒæµ‹è¯•
- `internal/api/routes.go`: æ›´æ–° Handler ä½¿ç”¨æ–°çš„ç®¡ç†å™¨

**APIå˜æ›´**:
- REST API: `sqlInfo` å’Œ `sqlHealth` ç°åœ¨ä½¿ç”¨è¯¾ç¨‹ç‰¹å®šçš„è¿æ¥æ± 
- WebSocket SQL: `handleSqlWebSocket` æ ¹æ® `courseObj.ID` è·¯ç”±åˆ°æ­£ç¡®çš„è¿æ¥æ± 

---

### 3. APIå±‚å…¨å±€äº’æ–¥é”æ€§èƒ½ç“¶é¢ˆ âœ… å·²ä¿®å¤

**çŠ¶æ€**: **å·²ä¿®å¤** (2026-02-10)

**ä½ç½®**: `internal/api/routes.go:45`

**é—®é¢˜æè¿°**:
è™½ç„¶ Docker æ§åˆ¶å™¨å†…éƒ¨å·²å®ç°è¯¾ç¨‹çº§åˆ«çš„äº’æ–¥é”ï¼ˆ`courseMu`ï¼‰ï¼Œä½† API å±‚ (`routes.go`) ä»ä½¿ç”¨å…¨å±€çš„ `containerMutex`ï¼š
```go
h.containerMutex.Lock()
defer h.containerMutex.Unlock()
```
è¿™å¯¼è‡´ä»»ä½•è¯¾ç¨‹çš„å®¹å™¨æ“ä½œéƒ½ä¼šé˜»å¡å…¶ä»–è¯¾ç¨‹çš„æ“ä½œï¼Œå¤±å»äº†è¯¾ç¨‹çº§é”çš„æ„ä¹‰ã€‚

**æ½œåœ¨å½±å“**:
- å¹¶å‘æ€§èƒ½ä¸¥é‡ä¸‹é™
- ç”¨æˆ·ä½“éªŒå·®ï¼ˆå¯åŠ¨Aè¯¾ç¨‹ä¼šé˜»å¡Bè¯¾ç¨‹çš„åœæ­¢æ“ä½œï¼‰
- æ— æ³•å……åˆ†åˆ©ç”¨å¤šæ ¸CPU

**ä¿®å¤æ–¹æ¡ˆ**:
1. **ç§»é™¤ API å±‚å…¨å±€é”** (`internal/api/routes.go`):
   - åˆ é™¤ `containerMutex sync.Mutex` å­—æ®µ
   - ç§»é™¤æ‰€æœ‰æ–¹æ³•ä¸­çš„é”è·å–/é‡Šæ”¾ä»£ç 
   - ç§»é™¤ç›¸å…³çš„è°ƒè¯•æ—¥å¿—ï¼ˆ"è·å–å®¹å™¨æ“ä½œé”"ï¼‰

2. **ä¾èµ– Docker æ§åˆ¶å™¨çš„è¯¾ç¨‹çº§é”**:
   - `CreateContainerWithProgress` å·²ä½¿ç”¨ `getCourseMutex(courseID)` ç¡®ä¿åŒä¸€è¯¾ç¨‹ä¸ä¼šå¹¶å‘åˆ›å»ºå®¹å™¨
   - è¯»æ“ä½œä½¿ç”¨ `d.mu.RLock()` ä¿æŠ¤å®¹å™¨æ˜ å°„è¡¨è®¿é—®
   - å†™æ“ä½œä½¿ç”¨ `d.mu.Lock()` ä¿æŠ¤çŠ¶æ€æ›´æ–°

3. **å¹¶å‘å®‰å…¨æ€§ä¿è¯**:
   - åˆ›å»ºå®¹å™¨ï¼šè¯¾ç¨‹çº§é”é˜²æ­¢åŒä¸€è¯¾ç¨‹å¹¶å‘åˆ›å»ºå¤šä¸ªå®¹å™¨
   - åœæ­¢/æš‚åœ/æ¢å¤ï¼šæ“ä½œæ˜¯å¹‚ç­‰çš„ï¼ŒDocker API çº¿ç¨‹å®‰å…¨
   - æ¸…ç†å®¹å™¨ï¼šé€šè¿‡å®¹å™¨IDæ“ä½œï¼Œæ˜ å°„è¡¨è®¿é—®å—è¯»å†™é”ä¿æŠ¤

**æ€§èƒ½æå‡**:
- ä¸åŒè¯¾ç¨‹çš„å®¹å™¨æ“ä½œç°åœ¨å¯ä»¥çœŸæ­£å¹¶è¡Œæ‰§è¡Œ
- å……åˆ†åˆ©ç”¨å¤šæ ¸ CPU å¤„ç†å¹¶å‘è¯·æ±‚
- ç”¨æˆ·å¯åŠ¨ A è¯¾ç¨‹ä¸å†é˜»å¡ B è¯¾ç¨‹çš„æ“ä½œ

**ç›¸å…³æ–‡ä»¶**:
- `internal/api/routes.go`: ç§»é™¤ containerMutex å­—æ®µå’Œç›¸å…³ä»£ç 

**éªŒè¯**:
- ä»£ç æˆåŠŸç¼–è¯‘é€šè¿‡
- Docker æ§åˆ¶å™¨å†…éƒ¨é”æœºåˆ¶å®Œæ•´ä¿ç•™
- å®¹å™¨æ“ä½œå¹¶å‘å®‰å…¨æ€§å¾—åˆ°ä¿è¯

---

### 4. WebSocket è¿æ¥ç¼ºå°‘å¿ƒè·³æ£€æµ‹ âœ… å·²ä¿®å¤

**çŠ¶æ€**: **å·²ä¿®å¤** (2026-02-10)

**ä½ç½®**: 
- `internal/api/routes.go:1173-1205`
- `internal/websocket/terminal.go`

**é—®é¢˜æè¿°**:
WebSocket ç»ˆç«¯è¿æ¥æ²¡æœ‰å®ç° ping/pong å¿ƒè·³æœºåˆ¶ã€‚åœ¨ç½‘ç»œä¸ç¨³å®šã€NATè¶…æ—¶ã€æˆ–å®¢æˆ·ç«¯å¼‚å¸¸æ–­å¼€æ—¶ï¼ŒæœåŠ¡ç«¯æ— æ³•åŠæ—¶æ„ŸçŸ¥è¿æ¥å·²å¤±æ•ˆï¼Œå¯¼è‡´ï¼š
- åƒµå°¸ä¼šè¯é•¿æœŸå ç”¨èµ„æº
- å†…å­˜æ³„æ¼ï¼ˆgoroutine å’Œè¿æ¥å¥æŸ„ï¼‰
- ç»ˆç«¯çŠ¶æ€ä¸å®é™…è¿æ¥çŠ¶æ€ä¸ä¸€è‡´

**æ½œåœ¨å½±å“**:
- æœåŠ¡å™¨èµ„æºè€—å°½
- å†…å­˜æ³„æ¼å¯¼è‡´æœåŠ¡å´©æºƒ
- ç”¨æˆ·çœ‹åˆ°"å·²è¿æ¥"ä½†å®é™…ä¼šè¯å·²å¤±æ•ˆ

**ä¿®å¤æ–¹æ¡ˆ**:

1. **ç»ˆç«¯ WebSocket å¿ƒè·³** (`internal/websocket/terminal.go`):
   å®é™…ä¸Šç»ˆç«¯WebSocketå·²ç»å®ç°äº†å®Œæ•´çš„å¿ƒè·³æœºåˆ¶ï¼š
   - `writePump()` ä½¿ç”¨ `ticker` æ¯ 54 ç§’å‘é€ `websocket.PingMessage`
   - `handleWebSocketInput()` è®¾ç½®äº† `SetPongHandler`ï¼Œæ”¶åˆ° pong é‡ç½®è¯»å–è¶…æ—¶
   - å¸¸é‡å®šä¹‰ï¼š`writeWait = 10s`, `pongWait = 60s`, `pingPeriod = 54s`

2. **SQL WebSocket å¿ƒè·³** (`internal/api/routes.go`):
   ä¸º SQL WebSocket æ·»åŠ äº†ç¼ºå¤±çš„å¿ƒè·³æœºåˆ¶ï¼š
   ```go
   // è®¾ç½®è¯»å–è¶…æ—¶å’Œpongå¤„ç†å™¨
   conn.SetReadDeadline(time.Now().Add(pongWait))
   conn.SetPongHandler(func(string) error {
       conn.SetReadDeadline(time.Now().Add(pongWait))
       return nil
   })
   
   // å¯åŠ¨pingåç¨‹å‘é€å¿ƒè·³
   go func() {
       ticker := time.NewTicker(pingPeriod)
       defer ticker.Stop()
       for {
           select {
           case <-ticker.C:
               conn.WriteMessage(websocket.PingMessage, nil)
           case <-stopPing:
               return
           }
       }
   }()
   ```

3. **åº”ç”¨å±‚å¿ƒè·³**:
   - åè®®æ”¯æŒï¼šå®¢æˆ·ç«¯å‘é€ `{type:"ping"}`ï¼ŒæœåŠ¡ç«¯å›å¤ `{type:"pong"}`
   - ç”¨äºæ£€æµ‹åº”ç”¨å±‚æ´»æ€§ï¼Œä¸ä¼ è¾“å±‚å¿ƒè·³äº’è¡¥

**è¶…æ—¶é…ç½®**:
- è¯»å–è¶…æ—¶: 60 ç§’ï¼ˆæœªæ”¶åˆ° pong åˆ™è®¤ä¸ºè¿æ¥æ–­å¼€ï¼‰
- å†™å…¥è¶…æ—¶: 10 ç§’
- Ping å‘¨æœŸ: 54 ç§’ï¼ˆpongWait çš„ 90%ï¼‰

**èµ„æºæ¸…ç†**:
- è¿æ¥æ–­å¼€æ—¶è‡ªåŠ¨åœæ­¢ ping åç¨‹ï¼ˆé€šè¿‡ `stopPing` é€šé“ï¼‰
- å…³é—­ WebSocket è¿æ¥
- æ¸…ç†ä¼šè¯èµ„æº

**ç›¸å…³æ–‡ä»¶**:
- `internal/api/routes.go`: ä¸º SQL WebSocket æ·»åŠ å¿ƒè·³æœºåˆ¶
- `internal/websocket/terminal.go`: ç»ˆç«¯WebSocketå·²æœ‰å®Œæ•´å¿ƒè·³

**éªŒè¯**:
- ä»£ç æˆåŠŸç¼–è¯‘é€šè¿‡
- ä¼ è¾“å±‚å’Œåº”ç”¨å±‚å¿ƒè·³åŒé‡ä¿éšœ
- åƒµå°¸è¿æ¥ä¼šè‡ªåŠ¨è¢«æ£€æµ‹å’Œæ¸…ç†

---

## ğŸŸ¡ ä¸­ç­‰é—®é¢˜ (Medium)

### 5. å‰ç«¯çŠ¶æ€ç®¡ç†æ··ä¹±

**çŠ¶æ€**: **æ¸è¿›å¼è¿ç§»ä¸­** (2026-02-10)

**ä½ç½®**: `src/pages/Learn.tsx`

**é—®é¢˜æè¿°**:
Learn é¡µé¢ä½¿ç”¨äº†çº¦20ä¸ªç‹¬ç«‹çš„ `useState`ï¼ŒçŠ¶æ€ä¹‹é—´ä¾èµ–å…³ç³»å¤æ‚ï¼š
```typescript
const [course, setCourse] = useState<Course | null>(null)
const [currentStep, setCurrentStep] = useState(-1)
const [loading, setLoading] = useState(true)
const [containerId, setContainerId] = useState<string | null>(null)
const [containerStatus, setContainerStatus] = useState<ContainerStatus>('stopped')
// ... è¿˜æœ‰15+ä¸ªçŠ¶æ€
```

çŠ¶æ€é€»è¾‘åˆ†æ•£åœ¨å¤šä¸ª `useEffect` ä¸­ï¼Œéš¾ä»¥è¿½è¸ªå’Œè°ƒè¯•ã€‚

**æ½œåœ¨å½±å“**:
- çŠ¶æ€æ›´æ–°é€»è¾‘å¤æ‚ï¼Œå®¹æ˜“å¼•å…¥bug
- ç»„ä»¶é‡æ¸²æŸ“æ€§èƒ½é—®é¢˜
- éš¾ä»¥æµ‹è¯•å’Œç»´æŠ¤
- çŠ¶æ€ä¸ä¸€è‡´é£é™©

**ä¿®å¤æ–¹æ¡ˆ**:

#### Phase 1: åˆ›å»º Zustand Store âœ… å·²å®Œæˆ
- **çŠ¶æ€ç®¡ç† Store** (`src/store/learnStore.ts`):
  - `LearnState`: åŒ…å«æ‰€æœ‰çŠ¶æ€å˜é‡
  - `LearnActions`: åŒ…å«æ‰€æœ‰æ“ä½œæ–¹æ³•
  - ä½¿ç”¨ `devtools` ä¸­é—´ä»¶ä¾¿äºè°ƒè¯•
  - ä½¿ç”¨ `persist` ä¸­é—´ä»¶æŒä¹…åŒ–å­˜å‚¨

#### Phase 2: åˆæ­¥è¿ç§» Learn.tsx âœ… å·²å®Œæˆ
```typescript
// æ›¿æ¢å‰
const [course, setCourse] = useState<Course | null>(null)
const [containerStatus, setContainerStatus] = useState<ContainerStatus>('stopped')

// æ›¿æ¢å
const {
  course, setCourse,
  containerStatus, setContainerStatus,
  // ... æ›´å¤šçŠ¶æ€
} = useLearnStore()
```

#### Phase 3: å¾…ç»§ç»­è¿ç§»
- [ ] è¿ç§» `startCourse` æ“ä½œä¸º store action
- [ ] è¿ç§» `stopCourse` æ“ä½œä¸º store action
- [ ] è¿ç§» `pauseCourse`/`resumeCourse` æ“ä½œ
- [ ] è¿ç§» `startStatusMonitoring` çŠ¶æ€ç›‘æ§
- [ ] ç®€åŒ–å†—ä½™çš„ `useEffect` å’Œ `ref`
- [ ] ç«¯å£å†²çªå’Œé•œåƒé€‰æ‹©å¤„ç†

**è¿ç§»è¿›åº¦**:
- çŠ¶æ€å˜é‡: 13/17 å·²è¿ç§»
- æ“ä½œæ–¹æ³•: 2/8 å·²è¿ç§»
- é€‰æ‹©å™¨: 2/2 å·²ä½¿ç”¨

**ç›¸å…³æ–‡ä»¶**:
- `src/store/learnStore.ts`: Zustand çŠ¶æ€ç®¡ç†å®ç°
- `src/pages/Learn.tsx`: æ¸è¿›å¼è¿ç§»ä¸­

**éªŒè¯**:
- TypeScript ç±»å‹æ£€æŸ¥é€šè¿‡ âœ…
- Learn.tsx åŠŸèƒ½æ­£å¸¸ï¼ˆå‘åå…¼å®¹ï¼‰

---

### 6. ç¼ºå°‘å‰ç«¯APIå®¢æˆ·ç«¯å°è£…

**ä½ç½®**: æ‰€æœ‰å‰ç«¯é¡µé¢ç»„ä»¶

**é—®é¢˜æè¿°**:
å‰ç«¯ç›´æ¥ä½¿ç”¨ `fetch` å‘èµ·è¯·æ±‚ï¼Œç¼ºå°‘ç»Ÿä¸€çš„å°è£…ï¼š
- é”™è¯¯å¤„ç†ä¸ä¸€è‡´
- é‡å¤çš„ç±»å‹è½¬æ¢ä»£ç 
- æ²¡æœ‰è¯·æ±‚æ‹¦æˆªå’Œé‡è¯•æœºåˆ¶
- ç¼ºä¹è¯·æ±‚å–æ¶ˆæ”¯æŒ

**æ½œåœ¨å½±å“**:
- é‡å¤ä»£ç å¤š
- é”™è¯¯å¤„ç†é—æ¼
- ç”¨æˆ·ä½“éªŒä¸ä¸€è‡´
- ç«æ€æ¡ä»¶é£é™©

**å»ºè®®ä¿®å¤**:
åˆ›å»ºç»Ÿä¸€çš„APIå®¢æˆ·ç«¯ï¼š
```typescript
// src/lib/api.ts
class ApiClient {
  async getCourses(): Promise<Course[]> {
    return this.request('/api/courses')
  }
  
  async startCourse(courseId: string, image?: string): Promise<StartCourseResponse> {
    return this.request(`/api/courses/${courseId}/start`, {
      method: 'POST',
      body: JSON.stringify({ image })
    })
  }
  
  private async request<T>(url: string, options?: RequestInit): Promise<T> {
    // ç»Ÿä¸€é”™è¯¯å¤„ç†ã€é‡è¯•ã€è¶…æ—¶
  }
}
```

---

### 7. é…ç½®éªŒè¯ä¸å¤Ÿä¸¥æ ¼

**ä½ç½®**: `internal/config/config.go:113-136`

**é—®é¢˜æè¿°**:
é…ç½®éªŒè¯åªè®°å½•è­¦å‘Šè€Œä¸é˜»æ­¢æœåŠ¡å¯åŠ¨ï¼š
```go
if err := validateConfig(config, configLogger); err != nil {
    configLogger.Warn("Configuration validation warning: %v", err)
}
```

ç¼ºå°‘ï¼š
- ç«¯å£å†²çªæ£€æŸ¥
- Docker socket è·¯å¾„éªŒè¯
- è¯¾ç¨‹ç›®å½•å¯è¯»æ€§æ£€æŸ¥

**æ½œåœ¨å½±å“**:
- å¯åŠ¨åæ‰å‘ç°é…ç½®é”™è¯¯
- ç”Ÿäº§ç¯å¢ƒæœåŠ¡å¼‚å¸¸
- éš¾ä»¥æ’æŸ¥é…ç½®é—®é¢˜

**å»ºè®®ä¿®å¤**:
å°†é…ç½®éªŒè¯æ”¹ä¸ºé˜»å¡å¼ï¼Œå¹¶æä¾›æ˜ç¡®çš„é”™è¯¯ä¿¡æ¯ï¼š
```go
func Load() (*Config, error) {
    config := &Config{...}
    if err := validateConfig(config); err != nil {
        return nil, fmt.Errorf("é…ç½®éªŒè¯å¤±è´¥: %w", err)
    }
    return config, nil
}
```

---

### 8. å•å…ƒæµ‹è¯•è¦†ç›–ç‡ä¸è¶³

**ä½ç½®**: æ•´ä¸ªé¡¹ç›®

**é—®é¢˜æè¿°**:
é¡¹ç›®ä¸­åªæœ‰ E2E æµ‹è¯•ï¼ˆPlaywrightï¼‰ï¼Œç¼ºä¹ï¼š
- Go å•å…ƒæµ‹è¯•ï¼ˆ`*_test.go`ï¼‰
- å‰ç«¯ç»„ä»¶æµ‹è¯•
- Docker æ§åˆ¶å™¨ mock æµ‹è¯•
- SQL é©±åŠ¨æµ‹è¯•

**æ½œåœ¨å½±å“**:
- å›å½’ bug éš¾ä»¥å‘ç°
- é‡æ„é£é™©é«˜
- ä»£ç è´¨é‡éš¾ä»¥ä¿è¯
- CI/CD åé¦ˆæ…¢

**å»ºè®®ä¿®å¤**:
æ·»åŠ æµ‹è¯•åŸºç¡€è®¾æ–½ï¼š
```go
// internal/docker/controller_test.go
func TestCreateContainer(t *testing.T) {
    mockClient := NewMockDockerClient()
    controller, _ := NewControllerWithClient(mockClient)
    
    // æµ‹è¯•å„ç§åœºæ™¯
}
```

---

### 9. defer rows.Close() åœ¨å¾ªç¯ä¸­ä½¿ç”¨

**ä½ç½®**: `internal/api/routes.go:1435`

**é—®é¢˜æè¿°**:
```go
defer rows.Close()
```
åœ¨å¾ªç¯ä¸­ä½¿ç”¨ `defer` ä¼šå¯¼è‡´èµ„æºå»¶è¿Ÿé‡Šæ”¾ï¼Œç›´åˆ°å‡½æ•°è¿”å›æ—¶æ‰å…³é—­ï¼Œå¯èƒ½å¯¼è‡´è¿æ¥æ± è€—å°½ã€‚

**æ½œåœ¨å½±å“**:
- æ•°æ®åº“è¿æ¥æ³„æ¼
- è¿æ¥æ± è€—å°½
- æ€§èƒ½ä¸‹é™

**å»ºè®®ä¿®å¤**:
```go
for rows.Next() {
    // å¤„ç†è¡Œ
}
rows.Close() // æ˜¾å¼å…³é—­ï¼Œä¸ä½¿ç”¨defer
```

---

## ğŸŸ¢ è½»å¾®é—®é¢˜ (Low)

### 10. ä»£ç é‡å¤

**ä½ç½®**: `internal/api/routes.go`

**é—®é¢˜æè¿°**:
`pauseCourse`, `resumeCourse`, `stopCourse` ç­‰æ–¹æ³•æœ‰å‡ ä¹ç›¸åŒçš„å®¹å™¨æŸ¥æ‰¾é€»è¾‘ï¼š
```go
// é‡å¤ä»£ç ï¼šæŸ¥æ‰¾å®¹å™¨çš„é€»è¾‘
containers, err := h.dockerController.ListContainers(ctx)
for _, container := range containers {
    if strings.HasPrefix(container.ID, coursePrefix) {
        // ...
    }
}
```

**å»ºè®®ä¿®å¤**:
æŠ½å–ä¸ºå…¬å…±æ–¹æ³•ï¼š
```go
func (h *Handler) findContainerByCourse(ctx context.Context, courseID string, states ...docker.ContainerState) (*docker.ContainerInfo, error) {
    // ç»Ÿä¸€çš„æŸ¥æ‰¾é€»è¾‘
}
```

---

### 11. ç±»å‹å®šä¹‰åˆ†æ•£

**ä½ç½®**: å¤šå¤„

**é—®é¢˜æè¿°**:
ç±»å‹å®šä¹‰æ•£è½åœ¨å¤šä¸ªæ–‡ä»¶ä¸­ï¼š
- `internal/docker/types.go`
- `internal/course/models.go`
- `src/types/container.ts`
- `src/types/port-conflict.ts`
- ç»„ä»¶å†…éƒ¨çš„æ¥å£å®šä¹‰

ç¼ºå°‘ç»Ÿä¸€çš„ç±»å‹ç®¡ç†ç­–ç•¥ã€‚

**å»ºè®®ä¿®å¤**:
- åç«¯ï¼šåœ¨æ¯ä¸ªåŒ…å†…å®šä¹‰è‡ªå·±çš„ç±»å‹ï¼Œé€šè¿‡æ¥å£éš”ç¦»
- å‰ç«¯ï¼šé›†ä¸­ç®¡ç†å…±äº«ç±»å‹ï¼Œç»„ä»¶ä¸“ç”¨ç±»å‹å®šä¹‰åœ¨ç»„ä»¶å†…

---

### 12. æ—¥å¿—æ ¼å¼ä¸ä¸€è‡´

**ä½ç½®**: æ•´ä¸ªåç«¯ä»£ç 

**é—®é¢˜æè¿°**:
- ä¸­è‹±æ–‡æ—¥å¿—æ··åˆ
- æ—¥å¿—çº§åˆ«ä½¿ç”¨ä¸ä¸€è‡´
- éƒ¨åˆ†æ—¥å¿—å¯èƒ½åŒ…å«æ•æ„Ÿä¿¡æ¯

**å»ºè®®ä¿®å¤**:
åˆ¶å®šæ—¥å¿—è§„èŒƒï¼š
- ç»Ÿä¸€ä½¿ç”¨ä¸­æ–‡æˆ–è‹±æ–‡ï¼ˆå»ºè®®ä¸­æ–‡ï¼Œç¬¦åˆç°æœ‰ä»£ç é£æ ¼ï¼‰
- ä½¿ç”¨ç»“æ„åŒ–æ—¥å¿—ï¼ˆJSONæ ¼å¼ï¼‰
- æ•æ„Ÿä¿¡æ¯è„±æ•å¤„ç†

---

## ğŸ“Š é—®é¢˜ç»Ÿè®¡

| ä¸¥é‡ç¨‹åº¦ | æ•°é‡ | é—®é¢˜ç¼–å· |
|---------|------|---------|
| ğŸ”´ ä¸¥é‡ | 4 | 1, 2, 3, 4 |
| ğŸŸ¡ ä¸­ç­‰ | 5 | 5, 6, 7, 8, 9 |
| ğŸŸ¢ è½»å¾® | 3 | 10, 11, 12 |
| **æ€»è®¡** | **12** | - |

---

## ğŸ¯ ä¿®å¤ä¼˜å…ˆçº§å»ºè®®

### ç«‹å³ä¿®å¤ (P0)
1. **é—®é¢˜2**: SQLé©±åŠ¨å•ä¾‹å¹¶å‘é—®é¢˜ - æ•°æ®å®‰å…¨é£é™©
2. **é—®é¢˜1**: å®¹å™¨IDè§£æé€»è¾‘ç¼ºé™· - åŠŸèƒ½é”™è¯¯é£é™©

### çŸ­æœŸä¿®å¤ (P1)
3. **é—®é¢˜3**: APIå±‚å…¨å±€äº’æ–¥é”æ€§èƒ½ç“¶é¢ˆ - æ€§èƒ½ä¼˜åŒ–
4. **é—®é¢˜4**: WebSocketå¿ƒè·³æ£€æµ‹ - ç¨³å®šæ€§æå‡
5. **é—®é¢˜9**: defer rows.Close() ä¿®å¤ - èµ„æºæ³„æ¼

### ä¸­æœŸæ”¹è¿› (P2)
6. **é—®é¢˜5**: å‰ç«¯çŠ¶æ€ç®¡ç†é‡æ„
7. **é—®é¢˜6**: APIå®¢æˆ·ç«¯å°è£…
8. **é—®é¢˜8**: å•å…ƒæµ‹è¯•è¦†ç›–

### é•¿æœŸä¼˜åŒ– (P3)
9. **é—®é¢˜7**: é…ç½®éªŒè¯å¢å¼º
10. **é—®é¢˜10**: ä»£ç é‡æ„å‡å°‘é‡å¤
11. **é—®é¢˜11**: ç±»å‹å®šä¹‰æ•´ç†
12. **é—®é¢˜12**: æ—¥å¿—è§„èŒƒåˆ¶å®š

---

## ğŸ“ å¤‡æ³¨

- æœ¬æ–‡æ¡£åº”ä¸ AGENTS.md ç»“åˆä½¿ç”¨ï¼Œä½œä¸ºä»£ç å®¡æŸ¥çš„å‚è€ƒ
- å»ºè®®å°†é«˜ä¼˜å…ˆçº§é—®é¢˜æ·»åŠ åˆ°é¡¹ç›®çš„ Issue è·Ÿè¸ªç³»ç»Ÿ
- ä¿®å¤æ—¶åº”è€ƒè™‘å‘åå…¼å®¹æ€§ï¼Œç‰¹åˆ«æ˜¯ API æ¥å£å˜æ›´
- å»ºè®®åœ¨ä¿®å¤åä¸ºæ¯ä¸ªé—®é¢˜æ·»åŠ ç›¸åº”çš„æµ‹è¯•ç”¨ä¾‹
